<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุถูู ูุนุจุฉ ุงููุงููุง</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- ุดุงุดุฉ ุงูุงูุชุธุงุฑ -->
        <div id="lobbyScreen" class="screen active">
            <h1>๐ญ ูุถูู ุงููุงููุง</h1>
            
            <div class="connection-info">
                <p>ุดุงุฑู ูุฐุง ุงูุฑุงุจุท ูุน ุงููุงุนุจูู:</p>
                <div class="url-box">
                    <input type="text" id="gameUrl" readonly>
                    <button onclick="copyGameUrl()">ูุณุฎ</button>
                </div>
            </div>

            <div class="players-section">
                <h3>ุงููุงุนุจูู ุงููุชุตููู (<span id="playersCount">0</span>)</h3>
                <div id="playersList" class="players-list"></div>
            </div>

            <div class="settings-section">
                <h3>ุฅุนุฏุงุฏุงุช ุงููุนุจุฉ</h3>
                
                <div class="setting-item">
                    <label>ุนุฏุฏ ุฃูุฑุงุฏ ุงููุงููุง:</label>
                    <div class="stepper">
                        <button onclick="changeMafiaCount(-1)">-</button>
                        <span id="mafiaCount">2</span>
                        <button onclick="changeMafiaCount(1)">+</button>
                    </div>
                </div>

                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="hasMedic">
                        ุงููุณุนู
                    </label>
                </div>

                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="hasHunter">
                        ุงูุตูุงุฏ
                    </label>
                </div>
            </div>

            <button id="startBtn" onclick="startGame()" disabled>ุจุฏุก ุงููุนุจุฉ</button>
        </div>

        <!-- ุดุงุดุฉ ุงููุนุจุฉ -->
        <div id="gameScreen" class="screen">
            <div class="game-header">
                <h2>๐ฏ ุงูุฌููุฉ <span id="dayNumber">1</span></h2>
                <div class="game-state" id="gameState">ูููุฉ</div>
            </div>

            <div id="phaseInfo" class="phase-info">
                <h3 id="phaseTitle">ุงููุฑุญูุฉ ุงูุญุงููุฉ</h3>
                <div id="phaseTimer" class="timer">--:--</div>
                <div id="phaseDescription" class="phase-desc"></div>
            </div>

            <div class="players-grid" id="playersGrid"></div>

            <!-- ุฒุฑ ุนุฑุถ ูุชุงุฆุฌ ุงูุชุตููุช -->
            <div id="votingSection" class="voting-section hidden">
                <h3>ุงูุชุตููุช ุงูุฌุงุฑู</h3>
                <button id="showVotesBtn" onclick="showVoteResults()">ุนุฑุถ ูุชุงุฆุฌ ุงูุชุตููุช</button>
            </div>

            <!-- ูุชุงุฆุฌ ุงูููู -->
            <div id="nightResults" class="results-section hidden">
                <h3>ูุชุงุฆุฌ ุงูููู</h3>
                <div id="nightResultsText"></div>
            </div>

            <!-- ูุชุงุฆุฌ ุงูุชุตููุช -->
            <div id="voteResults" class="results-section hidden">
                <h3>ูุชุงุฆุฌ ุงูุชุตููุช</h3>
                <div id="voteResultsText"></div>
            </div>

            <button onclick="resetGame()" class="secondary">ุฅููุงุก ุงููุนุจุฉ</button>
        </div>
    </div>

    <script src="client.js"></script>
    <script>
        let mafiaCount = 2;
        let players = [];

        function changeMafiaCount(change) {
            const maxMafia = Math.max(1, Math.floor(players.length / 3));
            mafiaCount = Math.max(1, Math.min(maxMafia, mafiaCount + change));
            document.getElementById('mafiaCount').textContent = mafiaCount;
        }

        function copyGameUrl() {
            const urlInput = document.getElementById('gameUrl');
            urlInput.select();
            document.execCommand('copy');
            alert('ุชู ูุณุฎ ุงูุฑุงุจุท!');
        }

        function startGame() {
            const settings = {
                mafiaCount: mafiaCount,
                hasMedic: document.getElementById('hasMedic').checked,
                hasHunter: document.getElementById('hasHunter').checked
            };
            
            gameClient.send({
                type: 'START_GAME',
                settings: settings
            });
        }

        function showVoteResults() {
            gameClient.send({
                type: 'SHOW_VOTE_RESULTS'
            });
        }

        function resetGame() {
            if (confirm('ูู ุชุฑูุฏ ุฅููุงุก ุงููุนุจุฉ ุงูุญุงููุฉุ')) {
                gameClient.send({
                    type: 'RESET_GAME'
                });
            }
        }

        // ุชุญุฏูุซ ูุงุฌูุฉ ุงููุถูู
        function updateHostInterface(gameData) {
            document.getElementById('dayNumber').textContent = gameData.dayNumber;
            document.getElementById('gameState').textContent = gameData.state === 'NIGHT' ? 'ูููุฉ' : 'ููุงุฑ';
            
            // ุชุญุฏูุซ ุญุงูุฉ ุงููุงุนุจูู
            updatePlayersGrid(gameData.players);
            
            // ุฅุธูุงุฑ/ุฅุฎูุงุก ุฃูุณุงู ุญุณุจ ุญุงูุฉ ุงููุนุจุฉ
            updateGameSections(gameData);
        }

        function updateGameSections(gameData) {
            const votingSection = document.getElementById('votingSection');
            const nightResults = document.getElementById('nightResults');
            const voteResults = document.getElementById('voteResults');

            if (gameData.state === 'VOTING') {
                votingSection.classList.remove('hidden');
            } else {
                votingSection.classList.add('hidden');
            }

            if (gameData.nightResults) {
                nightResults.classList.remove('hidden');
                document.getElementById('nightResultsText').textContent = gameData.nightResults;
            }

            if (gameData.voteResults) {
                voteResults.classList.remove('hidden');
                document.getElementById('voteResultsText').textContent = gameData.voteResults;
            }
        }

        function updatePlayersGrid(players) {
            const grid = document.getElementById('playersGrid');
            grid.innerHTML = '';
            
            players.forEach(player => {
                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${!player.alive ? 'dead' : ''}`;
                
                playerCard.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="player-role">${player.role || 'ูู ูุญุฏุฏ'}</div>
                    <div class="player-status">${player.alive ? 'ุญู' : 'ููุช'}</div>
                `;
                
                grid.appendChild(playerCard);
            });
        }

        // ุชุญุฏูุซ ุฑุงุจุท ุงููุนุจุฉ ุชููุงุฆูุงู
        window.addEventListener('load', function() {
            const gameUrl = `${window.location.origin}${window.location.pathname.replace('host.html', 'player.html')}`;
            document.getElementById('gameUrl').value = gameUrl;
        });
    </script>
</body>
</html>