<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุงุนุจ - ูุนุจุฉ ุงููุงููุง</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .optional-field {
            opacity: 0.7;
            font-size: 14px;
        }
        .auto-connect {
            background: rgba(76, 175, 80, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border-right: 3px solid #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ุดุงุดุฉ ุงูุงูุถูุงู -->
        <div id="joinScreen" class="screen active">
            <h1>๐ญ ุงูุถู ููุนุจุฉ ุงููุงููุง</h1>
            
            <div class="input-section">
                <input type="text" id="playerName" placeholder="ุฃุฏุฎู ุงุณูู" maxlength="20">
                <button onclick="joinGame()">ุงูุถู ููุนุจุฉ</button>
            </div>

            <div class="auto-connect">
                <p>โ <strong>ุณูุชู ุงูุงุชุตุงู ุชููุงุฆูุงู ุจุงูุฎุงุฏู ุงูุฑุฆูุณู</strong></p>
            </div>

            <div class="connection-info">
                <p class="optional-field">ููุงุชุตุงู ุจุฎุงุฏู ูุฎุชูู (ุงุฎุชูุงุฑู):</p>
                <input type="text" id="serverUrl" placeholder="ws://ุฎุงุฏู-ูุฎุชูู:3000" class="optional-input">
            </div>

            <div class="game-info">
                <h3>๐ฏ ุทุฑููุฉ ุงููุนุจ:</h3>
                <ul style="text-align: right; opacity: 0.8; font-size: 14px;">
                    <li>ุงุฏุฎู ุงุณูู ูุงููุฑ "ุงูุถู ููุนุจุฉ"</li>
                    <li>ุงูุชุธุฑ ูู ุบุฑูุฉ ุงูุงูุชุธุงุฑ ุญุชู ูุจุฏุฃ ุงููุถูู</li>
                    <li>ุณุชุธูุฑ ูู ุฏูุฑู ุชููุงุฆูุงู ุนูุฏ ุจุฏุก ุงููุนุจุฉ</li>
                    <li>ุงุชุจุน ุงูุชุนูููุงุช ูู ูู ูุฑุญูุฉ ูู ุงููุนุจุฉ</li>
                </ul>
            </div>
        </div>

        <!-- ุดุงุดุฉ ุงูุงูุชุธุงุฑ -->
        <div id="waitingScreen" class="screen">
            <h2>ูุฑุญุจุงู <span id="playerDisplayName"></span>! ๐</h2>
            
            <div class="connection-status">
                <div id="connectionInfo" class="info-box">
                    <p>โ ูุชุตู ุจุงูุฎุงุฏู ุงูุฑุฆูุณู</p>
                </div>
            </div>

            <div class="loading">
                <div class="spinner"></div>
                <p>ูู ุงูุชุธุงุฑ ุจุฏุก ุงููุนุจุฉ ูู ูุจู ุงููุถูู...</p>
            </div>

            <div class="players-section">
                <h3>ุงููุงุนุจูู ูู ุงูุบุฑูุฉ (<span id="playersCount">0</span>)</h3>
                <div id="playersWaiting" class="players-list"></div>
            </div>

            <button onclick="leaveGame()" class="secondary-btn">ุชุฑู ุงูุบุฑูุฉ</button>
        </div>

        <!-- ุดุงุดุฉ ุงููุนุจุฉ -->
        <div id="gameScreen" class="screen">
            <div class="player-header">
                <div class="role-display">
                    <h3>ุฏูุฑู: <span id="roleName" class="role-badge">...</span></h3>
                </div>
                <div class="game-info">
                    <span>ุงูุฌููุฉ <span id="currentDay">1</span></span> โข 
                    <span id="currentPhase">ูููุฉ</span>
                </div>
            </div>

            <!-- ูุนูููุงุช ุงููุฑุญูุฉ -->
            <div id="phaseInfo" class="phase-info">
                <h4 id="phaseTitle">ุงููุฑุญูุฉ ุงูุญุงููุฉ</h4>
                <div id="phaseTimer" class="timer">--:--</div>
                <div id="phaseDescription" class="phase-desc"></div>
                <audio id="phaseSound" preload="auto"></audio>
            </div>

            <!-- ูุงุฌูุฉ ุงูุฃุฏูุงุฑ ุงูุชูุงุนููุฉ -->
            <div id="roleInterface" class="role-interface hidden">
                <h4 id="actionTitle">ุฏูุฑู ุงูุขู</h4>
                <div id="actionDescription" class="action-desc"></div>
                <div id="playersSelection" class="players-selection"></div>
                <button id="confirmAction" onclick="confirmAction()" class="action-btn" disabled>ุชุฃููุฏ ุงูุงุฎุชูุงุฑ</button>
            </div>

            <!-- ูุชุงุฆุฌ ุงูุชุญูู (ูุฒุนูู ุงูุตุงูุญูู) -->
            <div id="checkResult" class="result-popup hidden">
                <div class="popup-content">
                    <h4>๐ ูุชูุฌุฉ ุงูุชุญูู</h4>
                    <div id="checkResultText" class="result-text"></div>
                    <button onclick="closeCheckResult()" class="action-btn">ุญุณูุงู</button>
                </div>
            </div>

            <!-- ูุงุฌูุฉ ุงูุชุตููุช -->
            <div id="votingInterface" class="voting-interface hidden">
                <h4>๐ณ๏ธ ุงูุชุตููุช ูุฅูุตุงุก ูุงุนุจ</h4>
                <div id="votingPlayers" class="players-selection"></div>
                <button id="confirmVote" onclick="confirmVote()" class="action-btn" disabled>ุชุฃููุฏ ุงูุชุตููุช</button>
            </div>

            <!-- ูุงุฌูุฉ ุงูุตูุงุฏ -->
            <div id="hunterInterface" class="hunter-interface hidden">
                <h4>๐ฏ ุฃูุช ุงูุตูุงุฏ!</h4>
                <p>ุงุฎุชุฑ ูุงุนุจุงู ููุฎุฑุฌ ูุนู:</p>
                <div id="hunterPlayers" class="players-selection"></div>
                <button id="confirmHunter" onclick="confirmHunterChoice()" class="action-btn" disabled>ุชุฃููุฏ ุงูุงุฎุชูุงุฑ</button>
            </div>

            <!-- ุญุงูุฉ ุงููุนุจุฉ -->
            <div id="gameStatus" class="game-status">
                <div id="statusMessage" class="status-message"></div>
                <div class="players-grid" id="playersGrid"></div>
            </div>

            <button onclick="leaveGame()" class="secondary-btn">ุชุฑู ุงููุนุจุฉ</button>
        </div>

        <!-- ุดุงุดุฉ ุงูุฎุทุฃ -->
        <div id="errorScreen" class="screen">
            <div class="error-content">
                <h2>โ ุญุฏุซ ุฎุทุฃ</h2>
                <p id="errorMessage">ุชุนุฐุฑ ุงูุงุชุตุงู ุจุงูุฎุงุฏู</p>
                <button onclick="showScreen('joinScreen')" class="action-btn">ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู</button>
            </div>
        </div>
    </div>

    <script src="client.js"></script>
    <script>
        // ุญุงูุฉ ุงููุงุนุจ ุงูุญุงูู
        let currentPlayer = {
            id: null,
            name: '',
            role: null,
            alive: true
        };
        
        let selectedPlayerId = null;
        let currentPhase = '';

        // ุงูุถู ููุนุจุฉ
        function joinGame() {
            const playerName = document.getElementById('playerName').value.trim();
            const serverUrl = document.getElementById('serverUrl').value.trim();
            
            if (!playerName) {
                showError('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณูู');
                return;
            }

            currentPlayer.name = playerName;
            
            // ุงุชุตุงู ุชููุงุฆู ุฅุฐุง ูู ูุฏุฎู ุงููุณุชุฎุฏู ุฑุงุจุท
            const finalServerUrl = serverUrl || ''; // ูุงุฑุบ = ุงุชุตุงู ุชููุงุฆู
            
            connectToServer(finalServerUrl, playerName);
        }

        // ุงูุงุชุตุงู ุจุงูุฎุงุฏู
        function connectToServer(serverUrl, playerName) {
            showMessage('ุฌุงุฑู ุงูุงุชุตุงู ุจุงูุฎุงุฏู...', 'info');
            gameClient.connect(serverUrl, playerName);
        }

        // ุชุฃููุฏ ุงูุฅุฌุฑุงุก (ุฃุฏูุงุฑ ุงูููู)
        function confirmAction() {
            if (!selectedPlayerId) {
                showError('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ูุงุนุจ');
                return;
            }
            
            const actionData = {
                type: 'NIGHT_ACTION',
                playerId: currentPlayer.id,
                targetId: selectedPlayerId,
                action: currentPhase
            };
            
            gameClient.send(actionData);
            hideRoleInterface();
            showMessage('ุชู ุฅุฑุณุงู ุงุฎุชูุงุฑู', 'success');
        }

        // ุชุฃููุฏ ุงูุชุตููุช
        function confirmVote() {
            if (!selectedPlayerId) {
                showError('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ูุงุนุจ ููุชุตููุช');
                return;
            }
            
            gameClient.send({
                type: 'VOTE',
                voterId: currentPlayer.id,
                targetId: selectedPlayerId
            });
            
            hideVotingInterface();
            showMessage('ุชู ุฅุฑุณุงู ุชุตููุชู', 'success');
        }

        // ุชุฃููุฏ ุงุฎุชูุงุฑ ุงูุตูุงุฏ
        function confirmHunterChoice() {
            if (!selectedPlayerId) {
                showError('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ูุงุนุจ');
                return;
            }
            
            gameClient.send({
                type: 'HUNTER_CHOICE',
                hunterId: currentPlayer.id,
                targetId: selectedPlayerId
            });
            
            hideHunterInterface();
            showMessage('ุชู ุฅุฑุณุงู ุงุฎุชูุงุฑู', 'success');
        }

        // ุงุฎุชูุงุฑ ูุงุนุจ
        function selectPlayer(playerId, element) {
            // ุฅูุบุงุก ุชุญุฏูุฏ ุฌููุน ุงููุงุนุจูู
            document.querySelectorAll('.player-selectable').forEach(el => {
                el.classList.remove('selected');
            });
            
            // ุชุญุฏูุฏ ุงููุงุนุจ ุงูุฌุฏูุฏ
            element.classList.add('selected');
            selectedPlayerId = playerId;
            
            // ุชูุนูู ุฃุฒุฑุงุฑ ุงูุชุฃููุฏ
            document.getElementById('confirmAction').disabled = false;
            document.getElementById('confirmVote').disabled = false;
            document.getElementById('confirmHunter').disabled = false;
        }

        // ุฅุบูุงู ูุชูุฌุฉ ุงูุชุญูู
        function closeCheckResult() {
            document.getElementById('checkResult').classList.add('hidden');
        }

        // ุฅุฎูุงุก ูุงุฌูุงุช ุงูุฃุฏูุงุฑ
        function hideRoleInterface() {
            document.getElementById('roleInterface').classList.add('hidden');
            selectedPlayerId = null;
        }

        function hideVotingInterface() {
            document.getElementById('votingInterface').classList.add('hidden');
            selectedPlayerId = null;
        }

        function hideHunterInterface() {
            document.getElementById('hunterInterface').classList.add('hidden');
            selectedPlayerId = null;
        }

        // ุชุฑู ุงููุนุจุฉ
        function leaveGame() {
            if (confirm('ูู ุชุฑูุฏ ุชุฑู ุงููุนุจุฉุ')) {
                if (gameClient.ws) {
                    gameClient.ws.close();
                }
                showScreen('joinScreen');
                resetGameState();
            }
        }

        // ุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงููุนุจุฉ
        function resetGameState() {
            currentPlayer = {
                id: null,
                name: '',
                role: null,
                alive: true
            };
            selectedPlayerId = null;
            currentPhase = '';
        }

        // ุนุฑุถ ุฑุณุงูุฉ
        function showMessage(message, type = 'info') {
            console.log(`๐ฌ ${type}: ${message}`);
            
            // ุนุฑุถ ุฅุดุนุงุฑ ูุคูุช
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                color: white;
                z-index: 1000;
                font-weight: bold;
                max-width: 300px;
                text-align: center;
                animation: slideIn 0.3s ease;
            `;
            
            const colors = {
                success: '#4CAF50',
                error: '#dc3545',
                info: '#17a2b8',
                warning: '#ffc107'
            };
            
            notification.style.background = colors[type] || colors.info;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }

        // ุนุฑุถ ุฎุทุฃ
        function showError(message) {
            showMessage(message, 'error');
        }

        // ุชุบููุฑ ุงูุดุงุดุฉ
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // ุชุญุฏูุซ ูุนูููุงุช ุงูุงุชุตุงู
        function updateConnectionInfo(serverUrl) {
            const connectionInfo = document.getElementById('connectionInfo');
            if (connectionInfo) {
                if (!serverUrl) {
                    connectionInfo.innerHTML = '<p>โ ูุชุตู ุจุงูุฎุงุฏู ุงูุฑุฆูุณู</p>';
                } else {
                    connectionInfo.innerHTML = `<p>โ ูุชุตู ุจุฎุงุฏู ูุฎุตุต</p>`;
                }
            }
        }

        // ุชุญุฏูุซ ุงุณู ุงููุงุนุจ ุงููุนุฑูุถ
        function updatePlayerDisplayName(name) {
            const displayName = document.getElementById('playerDisplayName');
            if (displayName) {
                displayName.textContent = name;
            }
        }

        // ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        window.addEventListener('load', function() {
            // ุฅุถุงูุฉ ุจุนุถ ุงูุฃููุงุท ุงูุฅุถุงููุฉ
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                .optional-input {
                    opacity: 0.7;
                    border: 1px dashed #ccc;
                }
                .optional-input:focus {
                    opacity: 1;
                    border: 2px solid #4CAF50;
                }
                .spinner {
                    border: 3px solid #f3f3f3;
                    border-top: 3px solid #4CAF50;
                    border-radius: 50%;
                    width: 30px;
                    height: 30px;
                    animation: spin 1s linear infinite;
                    margin: 0 auto;
                }
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);

            // ุชุนููู ุงููุต ุงูุชูุถูุญู
            const serverUrlInput = document.getElementById('serverUrl');
            if (serverUrlInput) {
                serverUrlInput.placeholder = "ุงุชุฑูู ูุงุฑุบุงู ููุงุชุตุงู ุงูุชููุงุฆู";
            }
        });
    </script>
</body>
</html>
